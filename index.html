<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islam | by Ayynan</title>
<meta name="description" content="A platform for sharing Islamic reminders and content by Ayynan.">
<meta name="keywords" content="Islam, Quran, Reminders, Ayynan">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        h1, h2 {
    scroll-margin-top: 80px; /* This keeps the heading from being hidden under the bar */
}
        html {
    scroll-behavior: smooth;
}
       /* 1. REPLACE your old .navbar, .nav-container, and .nav-link with THIS */
/* DASHING FULL-WIDTH NAVBAR */
.navbar {
    position: fixed; /* Fixes it to the absolute top */
    top: 0;
    left: 0;
    width: 100%; /* Touches both sides */
    background: var(--card-bg);
    border-bottom: 3px solid var(--btn-primary); /* The dashing outline */
    box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    z-index: 9999;
    padding: 12px 0;
    transition: all 0.3s ease;
}
/* Glassmorphism for the bar */
.navbar {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}
[data-theme="dark"] .navbar {
    background: rgba(18, 18, 18, 0.9);
    border-bottom: 3px solid var(--btn-primary);
}
.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between; 
    align-items: center;
    padding: 0 30px;
}
/* Add these new rules immediately after the .nav-container block */
.nav-logo { flex: 1; display: flex; justify-content: flex-start; }
.nav-links { flex: 1; display: flex; justify-content: center; gap: 30px; }
.nav-toggle-wrapper { flex: 1; display: flex; justify-content: flex-end; }
/* This centers the links specifically */
.nav-links {
    display: flex;
    gap: 30px;
    /* Remove any margin-left or margin-right from here */
}
/* Makes sure the button stays on the far right */
#theme-toggle {
    position: static;
    background: var(--text-color);
    color: var(--card-bg);
    border: none;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.3s;
}
.nav-link {
    text-decoration: none;
    color: var(--text-color);
    font-size: 13px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.7;
    transition: 0.3s;
}
.nav-link:hover {
    opacity: 1;
    color: var(--btn-primary);
    transform: translateY(-2px);
}
/* CLEANED UP BODY */
        :root {
            --bg-color: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --text-color: #1c1e21;
            --card-bg: white;
            --btn-primary: #007bff;
            --accent-bg: rgba(0, 123, 255, 0.1);
        }
        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #ffffff;
            --card-bg: #1e1e1e;
            --btn-primary: #3793ff;
            --accent-bg: rgba(255, 255, 255, 0.15);
        }
        body {
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    background: var(--bg-color);
    min-height: 100vh;
    color: var(--text-color);
    margin: 0; 
    /* This is the "Sweet Spot" - enough for a gap, but not too much */
    padding: 100px 20px 40px 20px; 
    transition: background 0.5s ease;
}
        #theme-toggle {
    position: static; /* No longer floating at bottom-right */
    background: var(--text-color);
    color: var(--card-bg);
    border: none;
    padding: 8px;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.3s;
}
        .container { max-width: 500px; margin: 0 auto; }
        img.profile-pic { border-radius: 50%; border: 5px solid white; width: 140px; height: 140px; object-fit: cover; margin-bottom: 10px; }

        /* KSA CLOCK */
        .clock-container { display: flex; flex-direction: column; align-items: center; margin: 15px 0; }
        .clock {
            width: 70px; height: 70px; border: 3px solid var(--btn-primary);
            border-radius: 50%; position: relative; background: var(--card-bg);
        }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: var(--text-color); border-radius: 4px; transform: translateX(-50%); }
        .hour { width: 3px; height: 25%; z-index: 3; }
        .min { width: 2px; height: 35%; z-index: 2; }
        .sec { width: 1px; height: 40%; background: #ff4757; z-index: 1; }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; background: var(--btn-primary); border-radius: 50%; transform: translate(-50%, -50%); z-index: 4; }
        .clock-label { font-size: 10px; font-weight: bold; margin-top: 5px; color: var(--btn-primary); }
        /* WELCOME BOX */
        .welcome-intro {
            background: var(--accent-bg); padding: 22px; border-radius: 15px;
            margin: 20px 0; text-align: left; line-height: 1.6;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .intro-header {
            display: flex; align-items: center; gap: 10px;
            font-weight: 800; color: var(--btn-primary);
            margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-size: 14px;
        }
        .arrow-prompt { font-size: 16px; font-weight: bold; color: var(--btn-primary); }
        /* SKILLS */
        .skills-bar { display: flex; justify-content: center; gap: 20px; font-size: 26px; margin: 20px 0; }
        .skills-bar i { transition: transform 0.2s; cursor: help; }
        .skills-bar i:hover { transform: scale(1.2); color: var(--btn-primary); }
        /* BIG BOX FEATURES */
        .section-title { margin-top: 35px; font-size: 20px; border-bottom: 3px solid var(--btn-primary); display: inline-block; padding-bottom: 5px; margin-bottom: 20px; }
        .grid-layout { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 10px; width: 100%; }
        .card-link { text-decoration: none; color: inherit; display: block; }
        .feature-card { 
            background: var(--card-bg); padding: 25px 15px; border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: 0.3s; 
            min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-sizing: border-box;
        }
        .feature-card:hover { transform: translateY(-8px); background: var(--accent-bg); border: 1px solid var(--btn-primary); }
        .feature-card i { font-size: 32px; margin-bottom: 12px; }
        .feature-card h3 { margin: 0; font-size: 16px; font-weight: 600; }
        /* MAIN BUTTONS */
        .main-btn { 
            background-color: var(--btn-primary); color: white; border: none; 
            padding: 16px; border-radius: 30px; font-size: 18px; font-weight: bold; 
            cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; 
            gap: 10px; text-decoration: none; margin-bottom: 15px; transition: 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .main-btn:hover { transform: translateY(-5px); filter: brightness(1.1); box-shadow: 0 8px 15px rgba(0,0,0,0.15); }

        form { background: var(--card-bg); padding: 20px; border-radius: 15px; display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
        input, textarea { padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: var(--card-bg); color: var(--text-color); font-family: inherit; }
        /* UPDATED PROFESSIONAL FOOTER */
        footer { margin-top: 40px; padding-bottom: 40px; }
        .final-msg { font-style: italic; font-weight: bold; color: var(--btn-primary); font-size: 18px; margin-bottom: 15px; }
        
        /* Better, Custom "System Counter" Look */
        .system-footer {
            display: inline-block; padding: 10px 20px; background: var(--card-bg);
            border-radius: 10px; border-left: 4px solid var(--btn-primary);
            text-align: left; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .sys-line { font-family: 'Courier New', monospace; font-size: 12px; color: var(--text-color); opacity: 0.7; margin: 2px 0; }
        .sys-val { color: var(--btn-primary); font-weight: bold; }
    /* Mobile Logic */
@media (max-width: 768px) {
    .nav-links {
        display: none; /* Hide links by default on mobile */
        flex-direction: column;
        position: absolute;
        top: 60px;
        left: 0;
        width: 100%;
        background: var(--card-bg);
        padding: 20px;
        border-bottom: 2px solid var(--btn-primary);
    }
    .nav-links.active {
        display: flex; /* Show links when "active" class is added */
    }
    .menu-icon {
        display: block; /* Show hamburger icon */
        cursor: pointer;
        font-size: 24px;
        flex: 1;
    }
    .nav-logo { flex: 2; justify-content: center; } /* Center logo on mobile */
}

@media (min-width: 769px) {
    .menu-icon { display: none; } /* Hide hamburger on desktop */
}
.modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
.modal-content { background: var(--card-bg); margin: 5% auto; padding: 20px; border-radius: 20px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; position: relative; }
.close-modal { position: absolute; right: 20px; top: 10px; font-size: 30px; cursor: pointer; color: var(--text-color); }
.surah-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
    padding: 20px 0; /* Creates breathing room below the header */
}
.surah-card { background: var(--accent-bg); padding: 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid transparent; }
.surah-card:hover { border-color: var(--btn-primary); transform: scale(1.05); }
.quran-text-container { font-family: 'Amiri', serif; font-size: 24px; line-height: 2.5; text-align: right; padding: 20px; direction: rtl; }
   .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(0, 123, 255, 0.1);
    border-left-color: var(--btn-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}
.arabic-text {
    font-family: 'Amiri', serif;
    font-size: 1.8rem;
    line-height: 2.5;
}

.translation-text {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin-top: 10px;
}
@keyframes spin { to { transform: rotate(360deg); } }
/* THE FIXED HEADER BAR */
.modal-nav {
    position: sticky;
    top: 0; /* Change from -20px to 0 */
    background: var(--card-bg);
    z-index: 1000;
}

.nav-left-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

#audio-container audio {
    height: 30px;
    width: 180px; /* Kept small to save space */
}

/* Make sure the title doesn't take up too much space */
.modal-nav h2 {
    font-size: 1.2rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
@media (max-width: 600px) {
    .modal-nav {
        flex-wrap: wrap; /* Allows audio player to drop to a second line if the screen is too narrow */
        justify-content: space-between;
    }
    #surah-audio {
        width: 100%; /* Makes audio player full width on small phones */
        margin-top: 10px;
    }
}
.audio-controls {
    display: flex;
    align-items: center;
    background: var(--accent-bg);
    padding: 5px 10px;
    border-radius: 50px; /* Makes it look like a pill */
    gap: 5px;
}

.skip-btn {
    background: transparent;
    border: none;
    color: var(--btn-primary);
    cursor: pointer;
    font-size: 16px;
    padding: 5px 10px;
    transition: 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.skip-btn:hover {
    color: var(--text-color);
    transform: scale(1.1);
}
/* Container to keep everything in one row */
.skip-control-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    margin-top: 5px;
}

/* Compact buttons that won't stack */
.compact-skip {
    background: #444;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap; /* Prevents text from wrapping */
    transition: 0.2s;
}

.compact-skip:hover {
    background: var(--btn-primary);
}

/* Ensures the audio player has enough room for the 3 dots */
#surah-audio {
    height: 35px;
    flex-grow: 1; /* Makes the player take up available space */
    min-width: 200px; /* Essential to show the three-dot menu */
}

@media (max-width: 480px) {
    #surah-audio {
        min-width: 150px; /* Smaller for mobile but still visible */
    }
}
.quran-player-bar {
    display: flex !important; /* Force flexbox */
    flex-direction: row !important; /* Force horizontal */
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 5px 0;
}

.player-btn {
    background: #444;
    color: white;
    border: none;
    border-radius: 15px;
    padding: 6px 10px;
    font-size: 11px;
    cursor: pointer;
    white-space: nowrap; /* Prevents the text from splitting into two lines */
    min-width: 45px;
}

#surah-audio {
    height: 35px;
    flex-grow: 1; /* Tells the player to take up all middle space */
    min-width: 220px; /* IMPORTANT: This is the minimum width needed for the 3 dots to appear */
}

/* On very small phones, hide the labels to save space for the 3 dots */
@media (max-width: 400px) {
    .player-btn {
        font-size: 10px;
        padding: 5px;
    }
    #surah-audio {
        min-width: 180px;
    }
}
/* Hide the standard browser "download" button to save space */
audio::-webkit-media-controls-enclosure {
    background-color: transparent;
}
#surah-list {
    display: grid !important;
    /* This creates a grid that automatically adds columns */
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important; 
    gap: 15px !important;
    padding: 20px !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Ensure the cards themselves don't stretch weirdly */
.surah-card {
    display: flex !important;
    flex-direction: row !important; /* Internal card content stays horizontal */
    justify-content: space-between;
    align-items: center;
    height: auto;
}
.ayah-block {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.arabic-text {
    line-height: 1.8;
    color: var(--text-color);
}
.trans-text {
    line-height: 1.5;
    color: var(--btn-primary);
    font-style: italic;
}
/* Container for each Verse + Translation pair */
.ayah-block {
    padding: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* High-quality Arabic styling */
.arabic-text {
    direction: rtl;
    text-align: right;
    font-family: 'Amiri', serif;
    font-size: 28px;
    line-height: 2;
    color: #fff;
}

/* Styling for English/Urdu translations */
.trans-text {
    font-size: 18px;
    line-height: 1.6;
    color: var(--btn-primary); /* Uses your theme color */
}

/* Tafseer Button Styling */
.tafseer-btn {
    background: #444;
    color: #00d4ff;
    border: 1px solid #00d4ff;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    align-self: flex-start; /* Keeps button on the side */
    transition: 0.3s;
}

.tafseer-btn:hover {
    background: #00d4ff;
    color: #000;
}
/* Forces the buttons to be small and side-by-side */
.player-btn, .compact-skip {
    display: inline-block !important;
    width: auto !important;
    margin: 0 5px !important;
}
#audio-container {
    display: none; /* Keep it hidden until loadSurah is called */
    width: 100%;
    margin-bottom: 15px;
}
/* 1. Ensure the container is visible and text is readable */
#surah-text {
    display: block !important;
    color: var(--text-color) !important; /* Fixes invisible text in dark mode */
    padding: 20px;
}
/* 2. Fix the "White on White" or "Dark on Dark" text bug */
.ayah-block {
    background: var(--card-bg); /* Matches your theme */
    padding: 20px;
    border-bottom: 1px solid var(--btn-primary);
    margin-bottom: 10px;
    border-radius: 8px;
}

/* 3. High-Quality Arabic Font */
.arabic-text {
    direction: rtl;
    text-align: right;
    font-family: 'Amiri', serif;
    font-size: 28px;
    line-height: 2.2;
    color: var(--text-color) !important;
    margin-bottom: 15px;
}

/* 4. Translation text styling */
.trans-text {
    direction: ltr;
    text-align: left;
    font-size: 16px;
    color: var(--btn-primary);
    line-height: 1.6;
    margin-top: 10px;
}
#surah-text {
    padding-top: 10px; /* Gives room so the first Ayah isn't hidden by the header */
}

.modal-content {
    padding-top: 0 !important; /* Ensure the header is the very first thing */
}
/* Paste this inside the <style> tag, NOT the <script> tag */
.modal-content {
    overflow-x: hidden !important;
    padding: 0 !important;
}

#surah-display-container {
    width: 100% !important;
    max-width: 100% !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
    margin: 0 !important;
}

#reader-header {
    width: 100% !important;
    box-sizing: border-box !important;
    background: white;
}
.loader {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* This hides the inner scrollbar while keeping the scroll function working */
#tafseer-content::-webkit-scrollbar {
    display: none;
}
#tafseer-content {
    -ms-overflow-style: none;
    scrollbar-width: none;
    overflow-y: auto; /* Only one scrollbar allowed */
}
/* Futuristic Radar Style */
/* Modern Minimalist Qibla Style */
#qibla-arrow-container {
    background: #ffffff;
    border: 1px solid #e0e0e0 !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
}

/* The Rotating Ring */
#qibla-needle {
    background: transparent !important;
    width: 100% !important;
    height: 100% !important;
    border-radius: 50%;
    border: 3px solid transparent;
    border-top-color: #007bff; /* The Blue Indicator */
    filter: drop-shadow(0 0 5px rgba(0, 123, 255, 0.4));
    transition: transform 0.1s linear; /* Fast response for live tracking */
}

/* Minimal Kaaba Icon in Center */
.kaaba-icon {
    position: absolute;
    width: 40px;
    height: 40px;
    background: #333;
    border-radius: 4px;
    border-top: 8px solid #ffd700; /* Gold band */
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
/* The pulsing Kaaba icon */
.kaaba-icon {
    width: 45px;
    height: 45px;
    background: #1a1a1a;
    border-radius: 6px;
    border-top: 10px solid #ffd700;
    z-index: 2;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.pulse-animation {
    animation: breathe 3s ease-in-out infinite;
}

@keyframes breathe {
    0% { transform: scale(1); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    50% { transform: scale(1.1); box-shadow: 0 5px 25px rgba(0, 123, 255, 0.4); }
    100% { transform: scale(1); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
}
/* Fix the celestial (Sun/Moon) orbit */
#sun-indicator {
    position: absolute;
    width: 260px; /* Make this slightly larger than the white circle */
    height: 260px;
    pointer-events: none;
    z-index: 5;
    transition: transform 0.5s ease-out; /* Smooth movement */
}

.celestial-icon {
    position: absolute;
    top: -25px; /* Pull it further out from the center */
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
}
   </style>
</head>
<body>
    <div id="offline-alert" style="display:none; background: #ff0000; color: white; text-align: center; padding: 10px; font-family: monospace; position: sticky; top: 0; z-index: 9999;">
    [!] SYSTEM OFFLINE: QIBLA & QURAN API UNAVAILABLE
</div>
<nav class="navbar">
    <div class="nav-container">
        <div class="nav-logo" >
             <span>‚ñ∂AYYNAN</span>
        </div>
        <div class="nav-links">
            <a href="#home" class="nav-link">Home</a>
            <a href="#development" class="nav-link">Development</a>
            <a href="#islam" class="nav-link">Islam</a>
            <a href="#contact" class="nav-link">Contact Us</a>
        </div>
        <div class="nav-toggle-wrapper">
            <button id="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </div>
    <div class="menu-icon" onclick="toggleMenu()">
    <i class="fas fa-bars"></i>
</div>
</nav>
    <div class="container">
        <img src="me.jpg" alt="Ayynan" class="profile-pic" id="home">
        <h1>Ayynan.codes</h1>
        <div class="clock-container">
            <div class="clock">
                <div class="center-dot"></div>
                <div id="hour" class="hand hour"></div>
                <div id="min" class="hand min"></div>
                <div id="sec" class="hand sec"></div>
            </div>
            <div class="clock-label">KSA TIME</div>
        </div>
        <div class="welcome-intro">
            <div class="intro-header"><span class="arrow-prompt">‚û§</span> SYSTEM ONLINE</div>
            <div>Hi, I'm <strong>Ayynan</strong>. I'm a developer building fast, responsive, and modern web experiences. <strong>Check out the features and tech stack I've used below!</strong></div>
        </div>
        <div class="skills-bar">
            <i class="fab fa-html5" title="HTML5"></i>
            <i class="fab fa-css3-alt" title="CSS3"></i>
            <i class="fab fa-js" title="JavaScript"></i>
            <i class="fab fa-github" title="GitHub"></i>
            <i class="fab fa-python" title="Python"></i>
            <i class="fas fa-dragon" title="Dragon Game Engine"></i>
        </div>
        <a href="https://github.com/Ayynan" target="_blank" class="main-btn">
            <i class="fab fa-github"></i> GitHub Profile
        </a>
        <a href="https://www.youtube.com/channel/UCKAK0xKz0c1oAJ3I2SUApHg" target="_blank" class="main-btn" style="background-color: #ff0000;">
            <i class="fab fa-youtube"></i> YouTube Channel
        </a>
        <h2 class="section-title" id="development">Development</h2>
        <div class="grid-layout">
            <a href="https://github.com/Ayynan/ayynan.github.io" target="_blank" class="card-link">
                <div class="feature-card">
                    <i class="fas fa-code" style="color: var(--btn-primary);"></i>
                    <h3>Site Source</h3>
                </div>
            </a>
            <a href="https://github.com/Ayynan" target="_blank" class="card-link">
                <div class="feature-card">
                    <i class="fas fa-folder-open" style="color: #ffaa00;"></i>
                    <h3>My Projects</h3>
                </div>
            </a>
        </div>
        <h2 class="section-title" id="islam">Islam</h2>
<div class="grid-layout">
    <a href="#" onclick="openQuran(event)" class="card-link">
        <div class="feature-card">
            <i class="fas fa-book-open" style="color: #2e7d32;"></i> 
            <h3>Quran</h3>
        </div>
    </a>
    <a href="audio.mp3" target="_blank" class="card-link">
        <div class="feature-card">
            <i class="fas fa-scroll" style="color: #1b5e20;"></i> 
            <h3>Hadith</h3>
        </div>
    </a>
    <a href="#" onclick="openQibla(event)" class="card-link">
        <div class="feature-card">
            <i class="fas fa-compass" style="color: #007bff;"></i> 
            <h3>Qibla</h3>
        </div>
    </a>
</div>
        <h2 class="section-title" id="contact">Contact</h2>
        <form action="https://formspree.io/f/ayynanwaheed2021@gmail.com" method="POST">
            <input type="text" name="name" placeholder="Name" required>
            <input type="email" name="email" placeholder="Email" required>
            <textarea name="message" rows="3" placeholder="Message" required></textarea>
            <button type="submit" class="main-btn">Send Message</button>
        </form>
        <div id="qibla-view" style="display:none; text-align:center; padding:40px; animation: fadeIn 0.5s;">
    <h2 style="font-weight: 300; letter-spacing: 1px;">Qibla Finder</h2>
    <p id="instruction-text" style="opacity: 0.6; font-size: 0.9rem;">Click below to activate live tracking</p>
    
    <div id="qibla-arrow-container" style="margin: 40px auto; width: 220px; height: 220px; border-radius: 50%; position: relative; border: 1px solid #e0e0e0; background: #fff; display: flex; align-items: center; justify-content: center;">
        <div class="kaaba-icon pulse-animation"></div>
        <div id="qibla-needle" style="position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 4px solid transparent; border-top-color: #007bff; transition: transform 0.1s linear;"></div>
        
        <div id="sun-indicator" style="position: absolute; width: 100%; height: 100%; border-radius: 50%; pointer-events: none; display: none;">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 24px;">‚òÄÔ∏è</div>
        </div>
    </div>
    
    <div id="qibla-info" style="font-size: 1.5rem; font-weight: bold; color: #007bff; margin-bottom:15px;">Sensor Paused</div>
    
    <button id="start-compass-btn" onclick="startCompass()" class="main-btn" style="background:#007bff; color:white; border:none; padding:12px 25px; border-radius:25px; cursor:pointer; font-weight:bold;">
        <i class="fas fa-compass"></i> ACTIVATE LIVE COMPASS
    </button>
    <br>
    <button onclick="closeQibla()" style="margin-top: 20px; background: none; border: none; color: #666; cursor: pointer;">‚úï Close</button>
</div>
        <footer>
            <div class="final-msg">"Coding is my language."</div>
            <div class="system-footer">
                <div class="sys-line">STATUS: <span class="sys-val">ONLINE</span></div>
                <div class="sys-line">USER: <span class="sys-val">AYYNAN_V1.0</span></div>
                <div class="sys-line">TOTAL_LOADS: <span class="sys-val" id="load-count">...</span></div>
            </div>
        </footer>
    </div>
    <div id="quran-modal" class="modal">
        <div class="modal-content">
            <div class="modal-nav">
                <div class="nav-left-group" style="display: flex; align-items: center; gap: 15px;">
                    <div id="back-btn-container" style="display:none; align-items:center; gap:100px; margin: 20px;">
    <button onclick="goBack()" class="main-btn" style="width:auto;">
        <i class="fas fa-arrow-left"></i> Back
    </button>
    
    <div style="display:flex; align-items:center; gap:5px; background:var(--accent-bg); padding:5px 10px; border-radius:20px;">
        <input type="number" id="ayah-jump-input" placeholder="Ayah #" 
               style="width:60px; border:none; background:transparent; color:var(--text-color); outline:none; text-align:center;">
        <button onclick="jumpToAyah()" style="background:var(--btn-primary); color:white; border:none; border-radius:15px; padding:3px 10px; cursor:pointer; font-size:12px;">
            Go
        </button>
    </div>
</div>
                    <div id="close-btn-container">
                        <button onclick="closeQuran()" class="main-btn" style="width:auto; padding:8px 12px; margin: 20px; background:#666;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                   <div id="reader-header" style="position: sticky; top: 0; background: white; z-index: 1000; padding: 10px; border-bottom: 1px solid #eee; width: 100%; box-sizing: border-box;">
    
    <div style="display: flex; align-items: center; justify-content: space-between; position: relative; min-height: 50px; width: 100%;">
        <h2 id="surah-title" style="position: absolute; left: 50%; transform: translateX(-50%); margin: 0; color: #007bff; font-family: 'Amiri', serif; font-size: 1.5rem; white-space: nowrap; text-align: center;">
            Surah Name
        </h2>
    </div>

    <div id="progress-container" style="width: 100%; height: 4px; background: #f0f0f0; margin-top: 10px; border-radius: 2px; overflow: hidden;">
        <div id="reading-progress-bar" style="width: 0%; height: 100%; background: #007bff; transition: width 0.1s ease;"></div>
    </div>
</div>
                </div>
            </div>

            <div id="audio-container" style="display:none; flex-direction: column; align-items: center; padding: 15px; background: var(--accent-bg); border-radius: 10px; margin: 15px 0;">
                <div style="margin-bottom: 10px; width: 100%;">
                    <label style="font-size: 11px; font-weight: bold; opacity: 0.7;">SELECT RECITER</label>
                    <select id="reciter-select" onchange="changeReciter()" style="width: 100%; padding: 8px; border-radius: 5px; background: var(--card-bg); color: var(--text-color);">
                        <option value="https://server8.mp3quran.net/afs/">Mishary Rashid Alafasy</option>
                        <option value="https://server11.mp3quran.net/sds/">Abdurrahmaan As-Sudais</option>
                        <option value="https://server6.mp3quran.net/shur/">Saud Al-Shuraim</option>
                        <option value="https://server13.mp3quran.net/yasser/">Yasser Al-Dosari</option>
                    </select>
                </div>
                <audio id="surah-audio" controls style="width: 100%;"></audio>
            </div>

            <div id="language-settings" style="display:none; margin: 10px 0; text-align: center; background: var(--accent-bg); padding: 10px; border-radius: 10px;">
    <label style="font-size: 14px; font-weight: bold;">Select View: </label>
    <select id="view-mode" onchange="fetchContent()" style="padding: 5px; border-radius: 5px; background: var(--card-bg); color: var(--text-color);">
        <optgroup label="Standard Translations">
            <option value="ar">Arabic Only</option>
            <option value="ur">Urdu (Jalandhry)</option>
            <option value="israr">Bayan-ul-Quran (Dr. Israr Ahmed)</option>
        </optgroup>
        <optgroup label="Scholarly Tafseer">
            <option value="maududi">Tafheem-ul-Quran (Maududi)</option>
        </optgroup>
    </select>
</div>

            <div id="surah-list-container">
    <div style="padding: 15px; display: flex; gap: 10px; flex-wrap: wrap; background: var(--accent-bg); border-radius: 10px; margin-bottom: 10px;">
        <input type="text" id="surah-search" oninput="searchSurah()" placeholder="üîç Search Surah name or number..."
               style="flex: 2; min-width: 200px; padding: 12px; border-radius: 25px; border: 1px solid var(--btn-primary); background: var(--card-bg); color: var(--text-color);">
        
        <div id="jump-ui" style="display:none; flex: 1; min-width: 150px; display: flex; gap: 5px;">
            <input type="number" id="ayah-jump" placeholder="Ayah #" 
                   style="width: 70px; padding: 10px; border-radius: 10px; border: 1px solid var(--btn-primary); background: var(--card-bg); color: var(--text-color);">
            <button onclick="jumpToAyah()" class="main-btn" style="width: auto; padding: 8px 15px; margin: 0; font-size: 12px;">JUMP</button>
        </div>
    </div>
    
    <div id="progress-wrapper" style="display:none; width: 100%; height: 6px; background: rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;">
        <div id="reading-progress-bar" style="width: 0%; height: 100%; background: var(--btn-primary); border-radius: 0 5px 5px 0; transition: width 0.1s ease;"></div>
    </div>

    <div id="surah-list" class="surah-grid"></div>
</div>

            <div id="surah-display-container" style="display:none;">
                <div id="surah-text" style="padding: 10px; min-height: 200px;">
                    </div>
            </div>
        </div> </div> <div id="tafseer-modal" class="modal" style="display:none; z-index: 99999;">
        <div class="modal-content" style="max-width: 600px; border-radius: 15px;">
            <div class="modal-nav">
                <h2 id="tafseer-title">Tafseer</h2>
                <button onclick="closeTafseer()" class="main-btn" style="width:auto; background:#666; border-radius: 50%; padding: 5px 10px;margin: 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="tafseer-content" style="padding: 20px; line-height: 1.8; color: var(--text-color);">
                Loading...
            </div>
        </div>
    </div>
    <script>
       /* --- SYSTEM & UI LOGIC --- */
let visits = localStorage.getItem('visit_count') || 0;
visits++;
localStorage.setItem('visit_count', visits);
if(document.getElementById('load-count')) {
    document.getElementById('load-count').innerText = visits.toString().padStart(5, '0');
}

function toggleTheme() {
    const body = document.documentElement;
    const isDark = body.getAttribute("data-theme") === "dark";
    body.setAttribute("data-theme", isDark ? "" : "dark");
    document.getElementById("theme-toggle").innerHTML = isDark ? "üåô" : "‚òÄÔ∏è";
}

function setClock() {
    const now = new Date();
    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
    const ksaNow = new Date(utc + (3600000 * 3));
    const secondsRatio = ksaNow.getSeconds() / 60;
    const minutesRatio = (secondsRatio + ksaNow.getMinutes()) / 60;
    const hoursRatio = (minutesRatio + ksaNow.getHours()) / 12;
    setRotation(document.getElementById('sec'), secondsRatio);
    setRotation(document.getElementById('min'), minutesRatio);
    setRotation(document.getElementById('hour'), hoursRatio);
}

function setRotation(element, rotationRatio) {
    if(element) element.style.setProperty('transform', `translateX(-50%) rotate(${rotationRatio * 360}deg)`);
}
setInterval(setClock, 1000);
setClock();

function toggleMenu() {
    document.querySelector('.nav-links').classList.toggle('active');
}

/* --- QURAN CORE LOGIC --- */
window.currentSurahId = 1;

// 1. Open Quran Modal
window.openQuran = function(e) {
    if(e) e.preventDefault();
    document.getElementById('quran-modal').style.display = 'block';
    window.goBack(); // Start at the list view
    fetchSurahs(); 
};

// 2. Fetch the list of 114 Surahs
async function fetchSurahs() {
    const list = document.getElementById('surah-list');
    if (!list || list.innerHTML.trim() !== "") return; 

    list.innerHTML = '<div style="grid-column: 1/-1; text-align:center; padding:20px;">Loading Surahs...</div>';
    
    try {
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const data = await res.json();
        list.innerHTML = '';
        data.data.forEach(surah => {
            const card = document.createElement('div');
            card.className = 'surah-card';
            card.innerHTML = `
                <div class="surah-info">
                    <span class="surah-number">${surah.number}</span>
                    <div>
                        <h4 style="margin:0;">${surah.englishName}</h4>
                        <small>${surah.name}</small>
                    </div>
                </div>`;
            card.onclick = () => loadSurah(surah.number, surah.englishName);
            list.appendChild(card);
        });
    } catch (err) {
        list.innerHTML = "Error loading list.";
    }
}

// 3. Load a specific Surah
window.loadSurah = async function(id, name) {
    window.currentSurahId = id;
    
    // 1. Switch Containers
    document.getElementById('surah-list-container').style.display = 'none';
    document.getElementById('surah-display-container').style.display = 'block';
    
    // 2. Show the "Hidden" Functions
    document.getElementById('audio-container').style.display = 'flex';
    document.getElementById('language-settings').style.display = 'block';
    document.getElementById('back-btn-container').style.display = 'block';
    document.getElementById('close-btn-container').style.display = 'none';
    
    // SHOW JUMP UI & PROGRESS BAR
    const jumpUI = document.getElementById('jump-ui');
    if(jumpUI) jumpUI.style.setProperty('display', 'flex', 'important');
    
    const progressWrap = document.getElementById('progress-wrapper');
    if(progressWrap) progressWrap.style.setProperty('display', 'block', 'important');

    document.getElementById('surah-title').innerText = name;

    window.changeReciter(); 
    window.fetchContent(); 
    window.saveLastRead(id, name); // Save for later
};

window.goBack = function() {
    document.getElementById('surah-title').innerText = "Holy Quran";
    document.getElementById('surah-list-container').style.display = 'block';
    document.getElementById('surah-display-container').style.display = 'none';
    
    // HIDE EVERYTHING AGAIN
    document.getElementById('audio-container').style.display = 'none';
    document.getElementById('language-settings').style.display = 'none';
    document.getElementById('back-btn-container').style.display = 'none';
    document.getElementById('close-btn-container').style.display = 'block';
    
    // HIDE JUMP & PROGRESS
    const jumpUI = document.getElementById('jump-ui');
    if(jumpUI) jumpUI.style.display = 'none';
    
    const progressWrap = document.getElementById('progress-wrapper');
    if(progressWrap) progressWrap.style.display = 'none';

    const player = document.getElementById('surah-audio');
    if (player) { player.pause(); player.src = ""; }
};

// 4. Fetch Verses
window.fetchContent = async function() {
    const display = document.getElementById('surah-text');
    const mode = document.getElementById('view-mode').value;
    
    if(!display) return;
    
    display.innerHTML = `
        <div style="text-align:center; padding:40px;">
            <div class="loader"></div>
            <p>Loading... Please wait.</p>
        </div>`;

    const editionMapping = {
        "ar": "quran-uthmani",
        "en": "en.sahih",
        "ur": "ur.jalandhry",
        "maududi": "ur.maududi",
        "israr": "ur.ahmedali" 
    };
    
    const selectedEdition = editionMapping[mode] || "en.sahih";

    try {
        const response = await fetch(`https://api.alquran.cloud/v1/surah/${window.currentSurahId}/editions/quran-uthmani,${selectedEdition}`);
        const result = await response.json();

        if (result.code === 200) {
            const ar = result.data[0].ayahs;
            const trans = result.data[1].ayahs;

            const htmlBuffer = ar.map((ayah, i) => {
                const showButton = mode === "ar" ? "none" : "block";
                
                // FIXED ALIGNMENT LOGIC:
                // English (en) -> Left (ltr)
                // Urdu/Maududi/Israr -> Right (rtl)
                const isEnglish = (mode === "en");
                const textAlign = isEnglish ? "left" : "right";
                const textDir = isEnglish ? "ltr" : "rtl";

                return `
                <div id="ayah-block-${i+1}" class="ayah-block" style="padding: 20px; border-bottom: 1px solid #eee;">
                    <p style="text-align:right; direction:rtl; font-size: 1.8rem; font-family: 'Amiri', serif;">
                        ${ayah.text} <span style="color:#007bff; font-size: 1.2rem;">(${i+1})</span>
                    </p>
                    
                    <p style="text-align:${textAlign}; direction:${textDir}; font-size: 1.1rem; color: #555; margin-top: 10px;">
                        ${(mode === "ar") ? "" : trans[i].text}
                    </p>
                    
                    <div style="display:flex; justify-content: space-between; margin-top:15px;">
                         <button onclick="copyAyah(${i+1})" style="background:none; border:none; color:#007bff; cursor:pointer;">
                            <i class="fas fa-copy"></i> Copy
                         </button>
                         <button onclick="window.showTafseer(${window.currentSurahId}, ${i+1})" 
                                 style="display:${showButton}; background:#007bff; color:white; border:none; padding:5px 15px; border-radius:15px; cursor:pointer;">
                            View Tafseer
                         </button>
                    </div>
                </div>`;
            }).join('');

            display.innerHTML = htmlBuffer;
        }
    } catch (e) {
        console.error(e);
        display.innerHTML = '<p style="color:red; text-align:center;">Load failed. Please check your connection.</p>';
    }
};
// Ensure Copy Function is outside
window.copyAyah = function(num) {
    const block = document.getElementById(`ayah-block-${num}`);
    const ar = block.querySelector('.arabic-text').innerText;
    const tr = block.querySelector('.translation-text').innerText;
    navigator.clipboard.writeText(`${ar}\n\n${tr}`).then(() => {
        alert("Ayah and Translation copied!");
    });
};

// 5. Navigation Control (Back to List)
window.goBack = function() {
    document.getElementById('surah-title').innerText = "Holy Quran";

    document.getElementById('surah-list-container').style.display = 'block';
    document.getElementById('surah-display-container').style.display = 'none';
    
    // --- HIDE THE UI ELEMENTS ---
    document.getElementById('audio-container').style.display = 'none';
    document.getElementById('language-settings').style.display = 'none'; // HIDE BAR
    document.getElementById('back-btn-container').style.display = 'none';
    document.getElementById('close-btn-container').style.display = 'block';
    document.getElementById('progress-wrapper').style.display = 'none';
    document.getElementById('jump-ui').style.display = 'none';
    const player = document.getElementById('surah-audio');
    if (player) {
        player.pause();
        player.src = "";
    }
};
window.closeQuran = function() {
    document.getElementById('quran-modal').style.display = 'none';
    const player = document.getElementById('surah-audio');
    if (player) player.pause();
};

/* --- AUDIO LOGIC --- */
window.changeReciter = function() {
    const player = document.getElementById('surah-audio');
    const reciterBaseUrl = document.getElementById('reciter-select').value;
    const paddedId = window.currentSurahId.toString().padStart(3, '0');
    player.src = reciterBaseUrl + paddedId + ".mp3";
    player.load();
};
window.showTafseer = async function(surahNum, ayahNum) {
    const tafseerModal = document.getElementById('tafseer-modal');
    const tafseerContent = document.getElementById('tafseer-content');
    const mode = document.getElementById('view-mode').value;

    if(tafseerModal) tafseerModal.style.display = 'block';
    tafseerContent.innerHTML = '<div style="text-align:center; padding:20px;"><div class="loader"></div><p>Loading Urdu Text...</p></div>';

    try {
        const timestamp = new Date().getTime();
        
        // 1. Set the correct ID for the "Scholarly Content" area
        let scholarId;
        if (mode === 'maududi') scholarId = 159;  // Maududi Urdu Tafseer
        else if (mode === 'israr') scholarId = 103; // Dr. Israr Urdu Translation (Better than 161)
        else if (mode === 'ur') scholarId = 158;    // Jalandhry Urdu Translation
        else scholarId = 169;                       // Ibn Kathir English

        // 2. Fetch data from the API
        // For Dr. Israr and Jalandhry, we fetch from the 'translations' endpoint to avoid Hindi Tafseer
        const apiUrl = (mode === 'maududi' || mode === 'en') 
            ? `https://api.quran.com/api/v4/tafsirs/${scholarId}/by_ayah/${surahNum}:${ayahNum}?language=ur&v=${timestamp}`
            : `https://api.quran.com/api/v4/quran/translations/${scholarId}?filters=${surahNum}:${ayahNum}&v=${timestamp}`;

        const [ayahRes, transRes, scholarRes] = await Promise.all([
            fetch(`https://api.alquran.cloud/v1/ayah/${surahNum}:${ayahNum}/ar.alafasy`),
            fetch(`https://api.alquran.cloud/v1/ayah/${surahNum}:${ayahNum}/ur.jalandhry`),
            fetch(apiUrl)
        ]);

        const ayahData = await ayahRes.json();
        const transData = await transRes.json();
        const scholarData = await scholarRes.json();

        // 3. Extract the text correctly based on the API response structure
        let finalScholarText = "";
        if (mode === 'maududi' || mode === 'en') {
            finalScholarText = scholarData.tafsir ? scholarData.tafsir.text : "Text unavailable.";
        } else {
            finalScholarText = (scholarData.translations && scholarData.translations[0]) 
                ? scholarData.translations[0].text 
                : "Translation unavailable.";
        }

        const isEnglish = (mode === 'en');
        const align = isEnglish ? 'left' : 'right';
        const dir = isEnglish ? 'ltr' : 'rtl';

        tafseerContent.innerHTML = `
            <div style="direction: ${dir}; text-align: ${align}; padding: 15px;">
                <button id="copy-taf-btn" style="float:left; background:#007bff; color:white; border:none; padding:5px 10px; border-radius:10px; cursor:pointer;">Copy</button>
                
                <h4 style="color:#007bff; margin-top:0;">Ayah:</h4>
                <p style="font-size:1.6rem; font-family:'Amiri'; text-align:right;">${ayahData.data.text}</p>
                
                <h4 style="color:#007bff; margin-top:20px;">Standard Translation (Jalandhry):</h4>
                <p style="font-size:1.1rem; font-weight:bold;">${transData.data.text}</p>
                
                <h4 style="color:#007bff; margin-top:20px;">${mode.toUpperCase()} Scholarly Content:</h4>
                <div id="taf-text" style="font-size:1.2rem; line-height:2.2; font-family: 'Noto Nastaliq Urdu', serif;">
                    ${finalScholarText}
                </div>
            </div>`;

        document.getElementById('copy-taf-btn').onclick = () => {
            navigator.clipboard.writeText(document.getElementById('taf-text').innerText);
            alert("Copied!");
        };

    } catch (e) {
        console.error(e);
        tafseerContent.innerHTML = "<p style='color:red; text-align:center;'>Connection Error. Please try again.</p>";
    }
};
window.closeTafseer = function() {
    const modal = document.getElementById('tafseer-modal');
    if (modal) {
        modal.style.display = 'none';
    }
};
window.onclick = function(event) {
    const quranModal = document.getElementById('quran-modal');
    const tafseerModal = document.getElementById('tafseer-modal');
    
    if (event.target == quranModal) {
        closeQuran();
    }
    if (event.target == tafseerModal) {
        closeTafseer();
    }
};

// 1. SEARCH LOGIC
window.searchSurah = function() {
    const input = document.getElementById('surah-search').value.toLowerCase();
    const cards = document.querySelectorAll('.surah-card');
    
    cards.forEach(card => {
        // This looks at the English Name, Arabic Name, and Number inside the card
        const text = card.innerText.toLowerCase();
        if (text.includes(input)) {
            card.style.setProperty('display', 'flex', 'important');
        } else {
            card.style.setProperty('display', 'none', 'important');
        }
    });
};

// 2. JUMP TO AYAH LOGIC
window.jumpToAyah = function() {
    let num = document.getElementById('ayah-jump').value;
    let target = document.getElementById(`ayah-block-${num}`);
    if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.style.backgroundColor = "var(--accent-bg)"; // Highlight target
        setTimeout(() => target.style.backgroundColor = "", 2000);
    } else {
        alert("Ayah not found in this Surah!");
    }
};

// 5. SAVE LAST READ (Function)
window.saveLastRead = function(id, name) {
    localStorage.setItem('last_surah_id', id);
    localStorage.setItem('last_surah_name', name);
    console.log(`Saved: ${name}`);
};
// 4. PROGRESS BAR LOGIC
const modalBody = document.querySelector('.modal-content'); // Or your scrollable container
modalBody.onscroll = function() {
    let winScroll = modalBody.scrollTop;
    let height = modalBody.scrollHeight - modalBody.clientHeight;
    let scrolled = (winScroll / height) * 100;
    let bar = document.getElementById("reading-progress-bar");
    if(bar) bar.style.width = scrolled + "%";
};

// 6. READ MORE LOGIC (Add this to your showTafseer function)
window.applyReadMore = function(text, limit = 500) {
    if (text.length <= limit) return text;
    return `
        <div class="tafseer-short">${text.substring(0, limit)}...</div>
        <div class="tafseer-full" style="display:none;">${text}</div>
        <button onclick="this.previousElementSibling.style.display='block'; this.previousElementSibling.previousElementSibling.style.display='none'; this.remove();" 
                style="color:var(--btn-primary); background:none; border:none; cursor:pointer; padding:0; font-weight:bold;">
            Read More
        </button>`;
};
// This tracks the scrolling inside the modal
document.querySelector('.modal-content').addEventListener('scroll', function() {
    const bar = document.getElementById("reading-progress-bar");
    if (!bar) return;
    
    const totalHeight = this.scrollHeight - this.clientHeight;
    const progress = (this.scrollTop / totalHeight) * 100;
    bar.style.width = progress + "%";
});
// 1. JUMP TO AYAH
window.jumpToAyah = function() {
    const num = document.getElementById('ayah-jump').value;
    const element = document.getElementById(`ayah-block-${num}`);
    if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        alert("Ayah not found!");
    }
};

// 2. COPY AYAH (Ensure this ID is in your fetchContent loop!)
window.copyAyah = function(num) {
    const block = document.getElementById(`ayah-block-${num}`);
    const text = block.innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
    });
};

// 3. PROGRESS BAR TRACKER
// Targets the scrolling div of your modal
document.getElementById('surah-display-container').addEventListener('scroll', function() {
    const bar = document.getElementById("reading-progress-bar");
    const totalHeight = this.scrollHeight - this.clientHeight;
    const scrolled = (this.scrollTop / totalHeight) * 100;
    if(bar) bar.style.width = scrolled + "%";
});
window.jumpToAyah = function() {
    const num = document.getElementById('ayah-jump-input').value;
    // This looks for the block we created in the fetchContent loop
    const target = document.getElementById(`ayah-block-${num}`);
    
    if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Flash the background color to show the user where they jumped to
        const originalColor = target.style.backgroundColor;
        target.style.backgroundColor = "var(--accent-bg)";
        setTimeout(() => {
            target.style.backgroundColor = originalColor;
        }, 2000);
    } else {
        alert("Verse " + num + " not found in this Surah.");
    }
};
// This function tracks how much you've read
document.getElementById('surah-display-container').addEventListener('scroll', function() {
    const bar = document.getElementById("reading-progress-bar");
    if (!bar) return; // Exit if bar doesn't exist

    const totalHeight = this.scrollHeight - this.clientHeight;
    const scrolled = (this.scrollTop / totalHeight) * 100;
    
    bar.style.width = scrolled + "%";
});
// We target the main display container
const readerElement = document.getElementById('surah-display-container');

if (readerElement) {
    readerElement.onscroll = function() {
        const totalHeight = readerElement.scrollHeight - readerElement.clientHeight;
        const progress = (readerElement.scrollTop / totalHeight) * 100000;
        const progressBar = document.getElementById("reading-progress-bar");
        if (progressBar) {
            progressBar.style.width = progress + "%";
        }
    };
}
// THIS GOES INSIDE YOUR <script> TAG
document.addEventListener('keypress', function (e) {
    if (e.key === 'Enter' && document.activeElement.id === 'ayah-jump-input') {
        jumpToAyah();
    }
});

window.jumpToAyah = function() {
    const num = document.getElementById('ayah-jump-input').value;
    const target = document.getElementById(`ayah-block-${num}`); // Ensure your IDs match
    if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        alert("Ayah " + num + " not found!");
    }
};
    window.openQibla = function(event) {
        if (!navigator.onLine) {
    alert("Qibla Finder requires an active internet connection to access GPS coordinates.");
    return;
}
    if(event) event.preventDefault();
    const container = document.querySelector('.container');
    
    container.innerHTML = `
        <div style="text-align:center; padding:40px; animation: fadeIn 0.5s;">
            <h2 style="font-weight: 300; letter-spacing: 1px;">Qibla Finder</h2>
            <p id="instruction-text" style="opacity: 0.6; font-size: 0.9rem;">Click the button below to activate live tracking</p>
            
            <div id="qibla-arrow-container" style="position: relative; width: 220px; height: 220px;">
    <div class="kaaba-icon pulse-animation"></div>
    
    <div id="qibla-needle" style="position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 4px solid transparent; border-top-color: #007bff;"></div>
    
    <div id="sun-indicator" style="display: none;">
        <div class="celestial-icon">üåô</div>
    </div>
</div>
    
    <div id="sun-indicator" style="position: absolute; width: 100%; height: 100%; border-radius: 50%; pointer-events: none; display: none;">
        <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 20px;">‚òÄÔ∏è</div>
    </div>
</div>
                </div>
            
            <div id="qibla-info" style="font-size: 1.5rem; font-weight: bold; color: #007bff; margin-bottom:15px;">Sensor Paused</div>
            
            <button id="start-compass-btn" onclick="startCompass()" class="main-btn" style="background:#007bff; color:white; border:none; padding:12px 25px; border-radius:25px; cursor:pointer; font-weight:bold;">
                <i class="fas fa-compass"></i> ACTIVATE LIVE COMPASS
            </button>
            <br>
            <button onclick="location.reload()" style="margin-top: 20px; background: none; border: none; color: #666; cursor: pointer;">‚úï Close</button>
        </div>
    `;

    let qiblaAngle = 0;

    // Fetch GPS and calculate fixed Qibla angle
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const kLat = 21.4225, kLng = 39.8262; // Kaaba

            const y = Math.sin((kLng - lng) * Math.PI/180);
            const x = Math.cos(lat * Math.PI/180) * Math.tan(kLat * Math.PI/180) -
                      Math.sin(lat * Math.PI/180) * Math.cos((kLng - lng) * Math.PI/180);
            
            qiblaAngle = (Math.atan2(y, x) * 180/Math.PI + 360) % 360;
        });
    }

    // This function handles the actual rotation once permission is granted
    window.startCompass = async function() {
    const celestialInd = document.getElementById('sun-indicator');
    const info = document.getElementById('qibla-info');
    const hour = new Date().getHours();

    // Force the icon to show immediately so you know the UI is alive
    celestialInd.style.display = 'block';
    celestialInd.innerHTML = `<div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 28px;">üåô</div>`;
    info.innerText = "Connecting to Sensors...";

    try {
        if (typeof DeviceOrientationEvent !== 'undefined' && 
            typeof DeviceOrientationEvent.requestPermission === 'function') {
            const res = await DeviceOrientationEvent.requestPermission();
            if (res === 'granted') {
                runLiveCompass();
            } else {
                info.innerText = "Access Denied";
            }
        } else {
            runLiveCompass();
        }
    } catch (e) {
        info.innerText = "Error: Use HTTPS";
    }
};

function runCompassLogic() {
    const info = document.getElementById('qibla-info');
    info.innerText = "Aligning...";

    // Use 'absolute' for Android and 'deviceorientation' for iOS
    const eventName = 'ondeviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation';

    window.addEventListener(eventName, (e) => {
        // webkitCompassHeading is the most accurate for iOS
        let heading = e.webkitCompassHeading || (360 - e.alpha);
        
        if (heading) {
            let relQibla = (qiblaAngle - heading + 360) % 360;
            
            // Update UI
            document.getElementById('qibla-needle').style.transform = `rotate(${relQibla}deg)`;
            
            if (Math.round(relQibla) <= 5 || Math.round(relQibla) >= 355) {
                info.innerText = "üïã Facing Kaaba";
                info.style.color = "#2e7d32";
                if (navigator.vibrate) navigator.vibrate(50);
            } else {
                info.innerText = `${Math.round(relQibla)}¬∞`;
                info.style.color = "#007bff";
            }
        }
    }, true);
}

    function initListeners() {
    // 'absolute' is critical for True North accuracy
    window.addEventListener('deviceorientationabsolute', handleRotate, true);
    
    // Fallback for older devices
    if (!('ondeviceorientationabsolute' in window)) {
        window.addEventListener('deviceorientation', handleRotate, true);
    }
}

function handleRotate(event) {
    // Add this at the top of your script to calculate solar position
function getSunBearing() {
    const hour = new Date().getHours();
    // Simple approximation: Sun rises at 90 (E) and sets at 270 (W)
    // In Buraydah, it moves roughly 15 degrees per hour
    return (hour * 15 + 180) % 360; 
}

function handleRotate(event) {
    let heading = event.webkitCompassHeading || (360 - event.alpha);
    
    if (heading) {
        let relativeAngle = (qiblaAngle - heading + 360) % 360;
        let sunAngle = (getSunBearing() - heading + 360) % 360;

        const needle = document.getElementById('qibla-needle');
        const sunIcon = document.getElementById('sun-indicator');
        
        // Rotate Qibla Indicator
        if(needle) needle.style.transform = `rotate(${relativeAngle}deg)`;
        
        // Rotate Sun Indicator
        if(sunIcon) {
            sunIcon.style.transform = `rotate(${sunAngle}deg)`;
            sunIcon.style.display = 'block';
        }

        // ... (keep your existing "Facing Kaaba" text logic here)
    }
}
    // Use webkitCompassHeading for iOS or absolute alpha for Android
    let heading = event.webkitCompassHeading || (event.absolute ? event.alpha : null);
    
    if (heading !== null) {
        // If using alpha on Android, it is usually 360 - alpha for clockwise heading
        if (!event.webkitCompassHeading) heading = 360 - heading;

        // The angle you need to turn the needle relative to your phone's front
        let relativeAngle = (qiblaAngle - heading + 360) % 360;
        
        const needle = document.getElementById('qibla-needle');
        const info = document.getElementById('qibla-info');
        const icon = document.querySelector('.kaaba-icon');

        needle.style.transform = `rotate(${relativeAngle}deg)`;

        // Strictness check: 5 degrees of tolerance
        if (relativeAngle <= 5 || relativeAngle >= 355) {
            info.innerText = "üïã Facing Kaaba";
            info.style.color = "#2e7d32";
            icon.style.filter = "drop-shadow(0 0 15px #2e7d32)"; // Glow green when correct
            
            // Haptic Feedback (Vibrate)
            if (navigator.vibrate) navigator.vibrate(50); 
        } else {
            info.innerText = `${Math.round(relativeAngle)}¬∞`;
            info.style.color = "#007bff";
            icon.style.filter = "none";
        }
    }
}
};

// Listen for network changes
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);

// Check status on initial load
updateOnlineStatus();
function getCelestialBearing() {
    const hour = new Date().getHours();
    // Simplified: Celestial bodies move 15 degrees per hour
    // This is an approximation to help you verify the compass
    return (hour * 15 + 180) % 360; 
}

function activateListeners() {
    const info = document.getElementById('qibla-info');
    const needle = document.getElementById('qibla-needle');
    const celestialInd = document.getElementById('sun-indicator');
    const hour = new Date().getHours();
    
    // Set icon based on time
    celestialInd.innerHTML = `<div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 24px;">${(hour >= 6 && hour < 18) ? '‚òÄÔ∏è' : 'üåô'}</div>`;

    const handler = (event) => {
        // Use the most accurate heading available for mobile websites
        let heading = event.webkitCompassHeading || (event.absolute ? event.alpha : null);
        
        if (heading !== null) {
            if (!event.webkitCompassHeading) heading = 360 - heading;

            // 1. Update Qibla
            let relQibla = (qiblaAngle - heading + 360) % 360;
            needle.style.transform = `rotate(${relQibla}deg)`;

            // 2. Update Moon/Sun
            let bearing = getCelestialBearing();
            let relCelestial = (bearing - heading + 360) % 360;
            celestialInd.style.display = 'block';
            celestialInd.style.transform = `rotate(${relCelestial}deg)`;

            // 3. UI Feedback
            if (relQibla <= 8 || relQibla >= 352) {
                info.innerText = "üïã Facing Kaaba";
                info.style.color = "#2e7d32";
                if (navigator.vibrate) navigator.vibrate(50);
            } else {
                info.innerText = `${Math.round(relQibla)}¬∞`;
                info.style.color = "#007bff";
            }
        }
    };

    window.addEventListener('deviceorientationabsolute', handler, true);
    window.addEventListener('deviceorientation', handler, true);
}
    </script>
</body>
</html>